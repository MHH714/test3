<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Web Proxy Viewer</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
    input { width: 60%; padding: 8px; border-radius: 6px; border: 1px solid #ccc; }
    button { padding: 8px 12px; margin: 4px; border: none; border-radius: 6px;
             background: #0078d7; color: white; cursor: pointer; }
    button:hover { background: #005a9e; }
    .tabs { margin-top: 10px; }
    .tab { display: inline-block; padding: 6px 12px; margin: 4px;
           background: #ddd; border-radius: 6px; cursor: pointer; }
    .tab.active { background: #0078d7; color: white; }
    iframe { width: 100%; height: 500px; margin-top: 20px; border: 1px solid #ccc; border-radius: 6px; }
  </style>
</head>
<body>
  <h2>Proxy Web Loader</h2>
  <input type="text" id="url" placeholder="Enter a website URL (e.g. https://example.com)">
  <button onclick="addTab()">Open</button>

  <div id="tabs" class="tabs"></div>
  <iframe id="viewer"></iframe>

  <script>
    let tabs = [];
    let currentIndex = -1;

    function addTab() {
      let url = document.getElementById("url").value.trim();
      if (!/^https?:\/\//i.test(url)) url = "https://" + url;

      // Use the proxy endpoint instead of direct URL
      let proxiedUrl = "/proxy?url=" + encodeURIComponent(url);

      tabs.push(proxiedUrl);
      currentIndex = tabs.length - 1;
      renderTabs();
      loadCurrent();
    }

    function switchTab(index) {
      currentIndex = index;
      renderTabs();
      loadCurrent();
    }

    function renderTabs() {
      const tabsDiv = document.getElementById("tabs");
      tabsDiv.innerHTML = "";
      tabs.forEach((url, i) => {
        const tab = document.createElement("div");
        tab.className = "tab" + (i === currentIndex ? " active" : "");
        tab.textContent = url.replace(/^.*\/proxy\?url=/, ""); // show clean URL
        tab.onclick = () => switchTab(i);
        tabsDiv.appendChild(tab);
      });
    }

    function loadCurrent() {
      if (currentIndex >= 0) {
        document.getElementById("viewer").src = tabs[currentIndex];
      }
    }
  </script>
</body>
</html>
